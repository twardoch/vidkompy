---
description: Rules and constraints governing video composition, overlay alignment, and synchronization
globs: src/vidkompy/core/alignment*.py,src/vidkompy/core/composition*.py,src/vidkompy/core/sync*.py
alwaysApply: false
---


# video-composition-rules

## Core Video Composition Logic

### Foreground Preservation Rules
- All foreground frames must be preserved without modification
- No resampling, retiming or quality reduction allowed
- Foreground audio takes precedence when available
- Original frame timing must be maintained exactly

Importance Score: 95

### Background Adaptation Rules
- Background video dynamically warped to match foreground timing
- Frame selection based on optimal temporal alignment
- Resolution/aspect ratio adjustments as needed
- Content-aware border handling for letterboxed videos

Importance Score: 85

### Synchronization Constraints
- Perfect frame-level synchronization required
- No temporal drift allowed over video duration
- Monotonic frame progression enforced
- Keyframe anchoring for stability points

Importance Score: 90

### Quality Control Rules
- Minimum confidence threshold for frame matching
- Alignment quality validation at key checkpoints
- Perceptual quality preservation requirements
- Error bounds for spatial positioning

Importance Score: 80

### Audio Integration Rules
- Foreground audio prioritized when available
- Background audio used as fallback
- Perfect audio/video sync maintained
- No audio quality degradation allowed

Importance Score: 75

$END$