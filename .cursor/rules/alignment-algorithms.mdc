---
description: Documentation for spatial and temporal video alignment algorithms used in automatic video overlay positioning
globs: src/vidkompy/*align*.py,src/vidkompy/matching/*.py
alwaysApply: false
---


# alignment-algorithms

## Temporal Alignment (Importance: 95)

Three main temporal alignment strategies:

1. Audio Alignment
- Cross-correlation of audio tracks between foreground and background videos
- Identifies optimal temporal offset by matching audio signatures
- Primary method when both videos contain sound

2. Duration-Based Alignment
- Centers foreground video within background video duration
- Basic fallback method when other alignment methods unavailable
- Assumes linear temporal relationship between videos

3. Frame-Based Alignment
- Advanced frame-by-frame content matching
- Builds dynamic mapping between foreground and background frames
- Handles variable frame rates and frame dropping/duplication
- Limited to max_keyframes (default 2000) for processing efficiency
- Known issue with drift-and-catchup artifacts in background portions

## Spatial Alignment (Importance: 90)

Two spatial alignment methods for positioning foreground video within background:

1. Template Matching (Precise)
- Default method for exact spatial alignment
- Uses OpenCV template matching to find exact sub-regions
- Identifies optimal offset position for foreground overlay
- Most accurate for similar video content

2. Feature Matching (Fast)
- Uses ORB (Oriented FAST and Rotated BRIEF) feature detection
- More robust for videos with significant differences
- Trades precision for speed and flexibility
- Better handles modified or processed video content

## Integration Logic (Importance: 85)

- Automatic detection of video dimensions ensures foreground fits within background
- Handles mismatched frame rates by using higher FPS for output
- Supports combined spatial and temporal alignment
- Trims output to aligned segments when trim=True
- Skip_spatial_align flag forces center positioning

$END$