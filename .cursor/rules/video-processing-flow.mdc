---
description: Documents video data flow for frame processing, alignment calculations, overlay composition, and output generation
globs: src/vidkompy/core/*.py,src/vidkompy/vidkompy*.py,src/vidkompy/models.py
alwaysApply: false
---


# video-processing-flow

## Frame Processing Flow
- Video frames are extracted and processed using a frame-by-frame pipeline:
  1. Frame extraction from source videos
  2. Frame fingerprinting using perceptual hashing
  3. Keyframe detection and analysis
  4. Frame matching and alignment calculation

Importance Score: 95 (Core video processing pipeline)

## Alignment Calculation Flow
- Two-stage alignment process:
  1. Spatial alignment using template/feature matching
  2. Temporal alignment using frame content or audio matching
- Generates frame mapping between foreground and background videos

Importance Score: 90 (Critical alignment logic)

## Overlay Composition Pipeline
1. Frame pair selection based on alignment mapping
2. Foreground frame overlay onto background frame
3. Output frame composition and encoding
4. Audio track selection and synchronization

Importance Score: 85 (Core video composition logic)

## Output Generation
- Handles synchronized video/audio output:
  - Uses foreground video's FPS as the target rate
  - Preserves foreground video timing
  - Adapts background video timing dynamically
  - Prioritizes foreground audio when available

Importance Score: 80 (Output generation workflow)

Key files:
- `src/vidkompy/core/video_processor.py`: Frame extraction and processing
- `src/vidkompy/core/alignment_engine.py`: Alignment coordination
- `src/vidkompy/core/spatial_alignment.py`: Spatial alignment
- `src/vidkompy/core/temporal_alignment.py`: Temporal alignment

$END$