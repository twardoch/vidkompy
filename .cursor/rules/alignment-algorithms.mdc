---
description: Documents video alignment algorithms for spatial/temporal synchronization and frame matching implementations
globs: src/vidkompy/core/alignment*.py,src/vidkompy/core/dtw*.py,src/vidkompy/core/temporal*.py,src/vidkompy/core/spatial*.py
alwaysApply: false
---


# alignment-algorithms

## Spatial Alignment Core (90/100)
- Advanced template matching using OpenCV for precise sub-region detection
- Two-phase alignment approach:
  1. Initial coarse positioning using feature detection (ORB) 
  2. Fine-tuning using normalized cross-correlation
- Compensates for compression artifacts and brightness variations
- Automatic position optimization within background frame bounds

## Temporal Synchronization Engine (95/100)
- Dynamic Time Warping (DTW) implementation for frame sequence alignment
- Perceptual hash-based frame fingerprinting for robust matching
- Adaptive keyframe selection with confidence-based early termination
- Multi-modal alignment combining audio and visual cues
- Zero-drift frame interpolation maintaining foreground timing integrity

## Frame Matching System (85/100)
- Combined perceptual hash algorithms (pHash, ColorMoment) for frame signatures
- Progressive refinement matching:
  1. Quick hash-based candidate identification
  2. Structural similarity validation
  3. Content-aware position adjustment
- Maintains foreground frame sequence while adapting background timing

## Audio-Visual Integration (80/100)
- Cross-correlation based audio track alignment
- Fallback chain for temporal synchronization:
  1. Audio track correlation
  2. Frame content matching
  3. Duration-based centering
- Intelligent audio source selection prioritizing foreground quality

Relevant Files:
```
src/vidkompy/core/alignment_engine.py
src/vidkompy/core/dtw_aligner.py 
src/vidkompy/core/spatial_alignment.py
src/vidkompy/core/temporal_alignment.py
```

$END$