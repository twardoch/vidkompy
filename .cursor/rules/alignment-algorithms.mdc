---
description: Algorithms for spatial and temporal alignment of video frames during synchronization and overlay processing
globs: src/vidkompy/core/alignment_engine.py,src/vidkompy/core/dtw_aligner.py,src/vidkompy/core/frame_fingerprint.py,src/vidkompy/core/spatial_alignment.py
alwaysApply: false
---


# alignment-algorithms

## Frame Fingerprinting System (Importance: 95)

Multi-algorithm perceptual hashing combining:
- pHash for frequency domain analysis
- AverageHash for mean color patterns 
- ColorMomentHash for color distribution stats
- MarrHildrethHash for edge/shape detection

Weighted similarity scoring prioritizes structural matches over color variations.

File: src/vidkompy/core/frame_fingerprint.py

## Temporal Alignment Engine (Importance: 98)

Dynamic Time Warping (DTW) implementation with:
- Sakoe-Chiba band constraint to prevent extreme warping
- Adaptive keyframe density based on FPS differences
- Monotonic frame mapping enforcement
- Linear interpolation between key matches
- Target of 200 keyframes for drift prevention

File: src/vidkompy/core/dtw_aligner.py

## Spatial Positioning System (Importance: 92)

Template matching with:
- Mid-point frame sampling strategy
- Normalized cross-correlation scoring
- Dynamic scale factor handling
- Border-based matching mode
- Edge blending support

File: src/vidkompy/core/spatial_alignment.py

## Core Alignment Rules (Importance: 96)

Video compositing policies:
- Foreground frame preservation guarantee
- Background warping to match foreground timing
- Intelligent audio source selection
- Frame sequence validation
- Progressive frame processing

File: src/vidkompy/core/alignment_engine.py

$END$